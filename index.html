<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phaistos Decoding Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Phaistos Disc Decoding Tool</h1>
    <input type="file" id="fileInput">
    <button onclick="storeFile()">Upload File</button>

    <br><br>
    
    <label for="diskModeSelect">Select Disk Mode:</label>
    <select id="diskModeSelect" onchange="changeDiskMode()">
        <option value="default">Default</option>
        <option value="vegas">Vegas</option>
    </select>

    <br><br>

    <button onclick="showDetailView()" id="detailButton">Show Detailed View</button>
    <br>

    <div hidden id="detailedView">
        <h3>Detailed Substitution View</h3>
        <button onclick="clearSubstitutions()">Clear Substitutions</button>
        <br><br>
        <div style="font-size: 1.5em;">
            <div>
                <pre style="display: inline;">&#x101D0:</pre> <input type="text" id="substitution1" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D1:</pre> <input type="text" id="substitution2" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D2:</pre> <input type="text" id="substitution3" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D3:</pre> <input type="text" id="substitution4" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D4:</pre> <input type="text" id="substitution5" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D5:</pre> <input type="text" id="substitution6" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D6:</pre> <input type="text" id="substitution7" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D7:</pre> <input type="text" id="substitution8" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D8:</pre> <input type="text" id="substitution9" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D9:</pre> <input type="text" id="substitution10" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101DA:</pre> <input type="text" id="substitution11" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101DB:</pre> <input type="text" id="substitution12" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
            </div>
            <br>
            <div>
                <pre style="display: inline;">&#x101DC:</pre> <input type="text" id="substitution13" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101DD:</pre> <input type="text" id="substitution14" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101DE:</pre> <input type="text" id="substitution15" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101DF:</pre> <input type="text" id="substitution16" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E0:</pre> <input type="text" id="substitution17" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E1:</pre> <input type="text" id="substitution18" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E2:</pre> <input type="text" id="substitution19" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E3:</pre> <input type="text" id="substitution20" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E4:</pre> <input type="text" id="substitution21" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E5:</pre> <input type="text" id="substitution22" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E6:</pre> <input type="text" id="substitution23" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E7:</pre> <input type="text" id="substitution24" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
            </div>
            <br>
            <div>
                <pre style="display: inline;">&#x101E8:</pre> <input type="text" id="substitution25" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E9:</pre> <input type="text" id="substitution26" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101EA:</pre> <input type="text" id="substitution27" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101EB:</pre> <input type="text" id="substitution28" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101EC:</pre> <input type="text" id="substitution29" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101ED:</pre> <input type="text" id="substitution30" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101EE:</pre> <input type="text" id="substitution31" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101EF:</pre> <input type="text" id="substitution32" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F0:</pre> <input type="text" id="substitution33" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F1:</pre> <input type="text" id="substitution34" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F2:</pre> <input type="text" id="substitution35" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F3:</pre> <input type="text" id="substitution36" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
            </div>
            <br>
            <div>
                <pre style="display: inline;">&#x101F4:</pre> <input type="text" id="substitution37" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F5:</pre> <input type="text" id="substitution38" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F6:</pre> <input type="text" id="substitution39" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F7:</pre> <input type="text" id="substitution40" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F8:</pre> <input type="text" id="substitution41" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F9:</pre> <input type="text" id="substitution42" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101FA:</pre> <input type="text" id="substitution43" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101FB:</pre> <input type="text" id="substitution44" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101FC:</pre> <input type="text" id="substitution45" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <!--- For some reason substitions for the damage mark does not work, this can be a future thing to fix and look into -->
                <!--- <pre style="display: inline;">Damage:</pre> <input type="text" id="substitution46" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre> -->
            </div>
            <br>
            <div> <!-- Subscript Override Text Entries-->
                <div style="font-size: 1em;">Subscript Override</div>
                <pre style="display: inline;">&#x101D0:</pre> <input type="text" id="substitution1S" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D4:</pre> <input type="text" id="substitution5S" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D6:</pre> <input type="text" id="substitution7S" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101D7:</pre> <input type="text" id="substitution8S" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E1:</pre> <input type="text" id="substitution18S" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101E9:</pre> <input type="text" id="substitution26S" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101F2:</pre> <input type="text" id="substitution35S" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>
                <pre style="display: inline;">&#x101FA:</pre> <input type="text" id="substitution43S" placeholder="" style="display: inline; width: 2em;"> <pre style="display:inline;">  </pre>

            </div>
            <br>
            <div> <!-- Character Exclusion Entries-->
                <div style="font-size: 1em;">Character Exclusions</div>
                <select id="addExclusionDropdown" onchange="addExclusion()">
                    <option value="default">Select Symbol to make Exclusion For</option>
                    <option value="1">&#x101D0;</option>
                    <option value="2">&#x101D1;</option>
                    <option value="3">&#x101D2;</option>
                    <option value="4">&#x101D3;</option>
                    <option value="5">&#x101D4;</option>
                    <option value="6">&#x101D5;</option>
                    <option value="7">&#x101D6;</option>
                    <option value="8">&#x101D7;</option>
                    <option value="9">&#x101D8;</option>
                    <option value="10">&#x101D9;</option>
                    <option value="11">&#x101DA;</option>
                    <option value="12">&#x101DB;</option>
                    <option value="13">&#x101DC;</option>
                    <option value="14">&#x101DD;</option>
                    <option value="15">&#x101DE;</option>
                    <option value="16">&#x101DF;</option>
                    <option value="17">&#x101E0;</option>
                    <option value="18">&#x101E1;</option>
                    <option value="19">&#x101E2;</option>
                    <option value="20">&#x101E3;</option>
                    <option value="21">&#x101E4;</option>
                    <option value="22">&#x101E5;</option>
                    <option value="23">&#x101E6;</option>
                    <option value="24">&#x101E7;</option>
                    <option value="25">&#x101E8;</option>
                    <option value="26">&#x101E9;</option>
                    <option value="27">&#x101EA;</option>
                    <option value="28">&#x101EB;</option>
                    <option value="29">&#x101EC;</option>
                    <option value="30">&#x101ED;</option>
                    <option value="31">&#x101EE;</option>
                    <option value="32">&#x101EF;</option>
                    <option value="33">&#x101F0;</option>
                    <option value="34">&#x101F1;</option>
                    <option value="35">&#x101F2;</option>
                    <option value="36">&#x101F3;</option>
                    <option value="37">&#x101F4;</option>
                    <option value="38">&#x101F5;</option>
                    <option value="39">&#x101F6;</option>
                    <option value="40">&#x101F7;</option>
                    <option value="41">&#x101F8;</option>
                    <option value="42">&#x101F9;</option>
                    <option value="43">&#x101FA;</option>
                    <option value="44">&#x101FB;</option>
                    <option value="45">&#x101FC;</option>
                </select>
                <ul id="exclusionList">

                </ul>
            </div>
        </div>
    </div>

    <br><br>

    <button onclick="createHangman()">Create Hangman</button>
    <h2>Created Hangman Combination</h2>
    <pre id="hangman"></pre>
    
    <div id="outputTables" style="border-color: white; font-size: 1.5em;" hidden>
        <table border="0" id="table1">
            <caption>Line 1A</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table2">
            <caption>Line 2A</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table3">
            <caption>Line 3A</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table4">
            <caption>Line 4A</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table5">
            <caption>Line 5A</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table6">
            <caption>Line 1B</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table7">
            <caption>Line 2B</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table8">
            <caption>Line 3B</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table9">
            <caption>Line 4B</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
        <br>
        <table border="0" id="table10">
            <caption>Line 5B</caption>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
        </table>
    </div>

    <script>
        let uploadedFile;
        let diskMode = "default";
        let detailedMode = false;

        class PhaistosSymbol {
            constructor(index, vegas = false, vowel = false, subscript = false, capital = false) {
            this.index = index;
            this.vegas = vegas;
            this.capital = capital;
            this.vowel = vowel;
            this.subscript = subscript;
            }
        }
    
        function storeFile() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length > 0) {
                uploadedFile = fileInput.files[0];
                console.log('File stored:', uploadedFile);
            } else {
                console.log('No file selected');
            }
        }

        function changeDiskMode() {
            const selectElement = document.getElementById('diskModeSelect');
            diskMode = selectElement.value;
            console.log('Disk mode changed to:', diskMode);
        }

        function showDetailView() {
            const detailedView = document.getElementById('detailedView');
            detailedMode = !detailedMode;
            detailedView.hidden = !detailedMode;
            detailButton.innerText = detailedMode ? 'Hide Detailed View' : 'Show Detailed View';
        }

        function clearSubstitutions(){
            for(let i = 1; i <= 46; i++){
                document.getElementById('substitution' + i).value = '';
            }
        }

        function addExclusion(){
            const dropdown = document.getElementById('addExclusionDropdown');
            const exclusionList = document.getElementById('exclusionList');
            const selectedValue = dropdown.value;
            if(selectedValue === 'default'){
                return;
            }
            const listItem = document.createElement('li');
            listItem.innerText = dropdown.options[dropdown.selectedIndex].text + ': ';
            const input = document.createElement('input');
            input.id = 'exclusion' + selectedValue;
            listItem.appendChild(input);
            exclusionList.appendChild(listItem);
            dropdown.value = 'default';
        }

        function createHangman() {
            if (!uploadedFile) {
            console.log('No file uploaded');
            return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const fileContent = event.target.result;
                var uniqueContent = hangmanForWebsite(fileContent);
                document.getElementById('hangman').innerHTML = uniqueContent;
            };
            
            document.getElementById('outputTables').hidden = false;
            reader.readAsText(uploadedFile);
        }

        function hangmanForWebsite(fileContent) {
            // Data Cleaning
            const rows = fileContent.split('\n');
            const cleanedRows = rows.map(row => {
                return row.split(',').map(cell => cell.trim() === 'NA' || cell.trim() === 'NaN' ? '' : cell).join(',');
            });
            
            const columns = [];
            const numColumns = cleanedRows[0].split(',').length;
            for (let i = 0; i < numColumns; i++) {
                const column = cleanedRows.map(row => row.split(',')[i]);
                columns.push(column.join(','));
            }
            const subList = [];

            // Loop through each column, creating a list of possible substitutions
            columns.forEach(column => {
                const uniqueSubs = new Set();
                column.split(',').forEach(cell => {
                    if (cell !== '' && cell !== '\r\n' && cell !== '\n' && cell !== '\r') {
                        uniqueSubs.add(cell.replace(/\r?\n|\r/g, ""));
                    }
                });
                subList.push(Array.from(uniqueSubs));
                uniqueSubs.clear();
            });

            // Select a random substitution from each list and pass it to hangman creation function
            let substitutions = [];
            for (let i = 1; i < subList.length; i++) {
                // If there is a substitution override in the detailed view, use that
                let override = document.getElementById('substitution' + i).value;
                let tempSubList = subList[i];
                console.log("Sub List for " + i + " is: " + tempSubList);

                if(override !== ''){
                    substitutions.push(override);
                // If the list only contains the index, there are no substitutions
                } else if (tempSubList.length === 1) {
                    substitutions.push("Unsubstituted");
                // There must be a list of substitutions to choose from, select on randomly
                } else {
                    let randomIndex = Math.floor(Math.random() * tempSubList.length);
                    let tempSub = '';

                    // Check if the substitution is being excluded
                    try{
                        const exclusions = document.getElementById('exclusion' + i).value;
                        console.log("Exclusions for " + i + " are: " + exclusions);
                        while(tempSub === '' || exclusions.includes(tempSub)){
                            randomIndex = Math.floor(Math.random() * tempSubList.length);
                            if (tempSubList[randomIndex] === undefined) {
                                tempSub = tempSubList[randomIndex - 1];
                            } else {
                                tempSub = tempSubList[randomIndex];
                            }
                            if(i === 3){
                                console.log("Im over here");
                            }
                        }
                    } catch(e) {
                        console.log(e)
                        if (tempSubList[randomIndex] === undefined) {
                            tempSub = tempSubList[randomIndex - 1];
                        } else {
                            tempSub = tempSubList[randomIndex];
                        }
                    }

                    substitutions.push(tempSub)
                }
            }
            substitutions = substitutions.join(',');

            return hangmanSubstitution(substitutions, diskMode);
        }

        function hangmanSubstitution(substitutions, diskOption = "default"){
            // Variable declarations
            let singleSubs = [], subTracker = [], diskSymbols = [], possibleSymbols = [], possibleVegasSymbols = [], possibleVowelSymbols = [], hexSymbols = [], returnString = "";
            
            // Selecting version of disk to substitute
            if(diskOption === "default"){
                diskSymbols = [[new PhaistosSymbol(38), new PhaistosSymbol(3), new PhaistosSymbol(10), '|', new PhaistosSymbol(1), new PhaistosSymbol(13), '|', new PhaistosSymbol(21), new PhaistosSymbol(37), new PhaistosSymbol(35), new PhaistosSymbol(27), new PhaistosSymbol(27), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(38), new PhaistosSymbol(3), new PhaistosSymbol(10), '|', new PhaistosSymbol(35, false, false, true), new PhaistosSymbol(19), new PhaistosSymbol(23), '|', new PhaistosSymbol(1), new PhaistosSymbol(13), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(12), new PhaistosSymbol(26), new PhaistosSymbol(31)],
                    [new PhaistosSymbol(19), new PhaistosSymbol(17), new PhaistosSymbol(18), new PhaistosSymbol(6), '|', new PhaistosSymbol(27), new PhaistosSymbol(18), new PhaistosSymbol(32), new PhaistosSymbol(14), new PhaistosSymbol(27), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(26, false, false, true), new PhaistosSymbol(31), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(1, false, false, true), new PhaistosSymbol(28), '|', new PhaistosSymbol(18), new PhaistosSymbol(22), new PhaistosSymbol(10), new PhaistosSymbol(25), new PhaistosSymbol(27), new PhaistosSymbol(2), '|', new PhaistosSymbol(26, false, false, true), new PhaistosSymbol(31), new PhaistosSymbol(12), new PhaistosSymbol(2)],
                    [new PhaistosSymbol(23), new PhaistosSymbol(33), '|', new PhaistosSymbol(21), new PhaistosSymbol(37), new PhaistosSymbol(35), new PhaistosSymbol(27), new PhaistosSymbol(27), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(26, false, false, true), new PhaistosSymbol(31), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(1), new PhaistosSymbol(28), '|', new PhaistosSymbol(18), new PhaistosSymbol(23), new PhaistosSymbol(10), new PhaistosSymbol(25), new PhaistosSymbol(27), new PhaistosSymbol(2), '|', new PhaistosSymbol(11), new PhaistosSymbol(39)],
                    [new PhaistosSymbol(38), new PhaistosSymbol(23), new PhaistosSymbol(32), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(7), new PhaistosSymbol(40), new PhaistosSymbol(41), new PhaistosSymbol(1), '|', new PhaistosSymbol(35), new PhaistosSymbol(19), new PhaistosSymbol(41), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(35), new PhaistosSymbol(26), new PhaistosSymbol(31), '|', new PhaistosSymbol(46), new PhaistosSymbol(18), new PhaistosSymbol(6), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(2), new PhaistosSymbol(44), new PhaistosSymbol(27)],
                    [new PhaistosSymbol(12), new PhaistosSymbol(7), new PhaistosSymbol(45), new PhaistosSymbol(27), '|', new PhaistosSymbol(33), new PhaistosSymbol(40), new PhaistosSymbol(4), new PhaistosSymbol(12), new PhaistosSymbol(2), '|', new PhaistosSymbol(34), new PhaistosSymbol(29), new PhaistosSymbol(29), '|', new PhaistosSymbol(7, false, false, true), new PhaistosSymbol(45), new PhaistosSymbol(29), '|', new PhaistosSymbol(12), new PhaistosSymbol(40), new PhaistosSymbol(24), '|', new PhaistosSymbol(18, false, false, true), new PhaistosSymbol(1), new PhaistosSymbol(13), new PhaistosSymbol(12), new PhaistosSymbol(2)],
                    [new PhaistosSymbol(7, false, false, true), new PhaistosSymbol(45), '|', new PhaistosSymbol(25), new PhaistosSymbol(23), new PhaistosSymbol(34), new PhaistosSymbol(29), '|', new PhaistosSymbol(7), new PhaistosSymbol(23), new PhaistosSymbol(35), new PhaistosSymbol(6), new PhaistosSymbol(2), '|', new PhaistosSymbol(7), new PhaistosSymbol(18), new PhaistosSymbol(39), new PhaistosSymbol(30), new PhaistosSymbol(9), '|', new PhaistosSymbol(8, false, false, true), new PhaistosSymbol(7), new PhaistosSymbol(36), new PhaistosSymbol(29), new PhaistosSymbol(22), '|', new PhaistosSymbol(24), new PhaistosSymbol(18), new PhaistosSymbol(23), new PhaistosSymbol(7)],
                    [new PhaistosSymbol(7, false, false, true), new PhaistosSymbol(45), new PhaistosSymbol(7), '|', new PhaistosSymbol(35), new PhaistosSymbol(18), new PhaistosSymbol(7), '|', new PhaistosSymbol(25), new PhaistosSymbol(23), new PhaistosSymbol(34), new PhaistosSymbol(27), '|', new PhaistosSymbol(8, false, false, true), new PhaistosSymbol(7), new PhaistosSymbol(36), new PhaistosSymbol(29), new PhaistosSymbol(22), '|', new PhaistosSymbol(7, false, false, true), new PhaistosSymbol(25), new PhaistosSymbol(29), '|', new PhaistosSymbol(13), new PhaistosSymbol(8), new PhaistosSymbol(29)],
                    [new PhaistosSymbol(8, false, false, true), new PhaistosSymbol(7), new PhaistosSymbol(36), new PhaistosSymbol(29), '|', new PhaistosSymbol(1), new PhaistosSymbol(27), new PhaistosSymbol(9), new PhaistosSymbol(2), '|', new PhaistosSymbol(33), new PhaistosSymbol(39), new PhaistosSymbol(32), new PhaistosSymbol(35), new PhaistosSymbol(6), '|', new PhaistosSymbol(1), new PhaistosSymbol(33), new PhaistosSymbol(29), '|', new PhaistosSymbol(18), new PhaistosSymbol(14), new PhaistosSymbol(16), '|', new PhaistosSymbol(35), new PhaistosSymbol(20), new PhaistosSymbol(24), new PhaistosSymbol(24), new PhaistosSymbol(29)],
                    [new PhaistosSymbol(1), new PhaistosSymbol(38), new PhaistosSymbol(25), new PhaistosSymbol(27), '|', new PhaistosSymbol(40), new PhaistosSymbol(36), new PhaistosSymbol(26), new PhaistosSymbol(2), '|', new PhaistosSymbol(35), new PhaistosSymbol(40), new PhaistosSymbol(24), new PhaistosSymbol(7), '|', new PhaistosSymbol(25), new PhaistosSymbol(42), new PhaistosSymbol(37), new PhaistosSymbol(22), '|', new PhaistosSymbol(18), new PhaistosSymbol(1), new PhaistosSymbol(13), new PhaistosSymbol(7), new PhaistosSymbol(15), '|', new PhaistosSymbol(33), new PhaistosSymbol(39), new PhaistosSymbol(1)],
                    [new PhaistosSymbol(43, false, false, true), new PhaistosSymbol(18), new PhaistosSymbol(23), new PhaistosSymbol(16), '|', new PhaistosSymbol(12), new PhaistosSymbol(20), new PhaistosSymbol(24), new PhaistosSymbol(33), '|', new PhaistosSymbol(27), new PhaistosSymbol(25), new PhaistosSymbol(22), '|', new PhaistosSymbol(5, false, false, true), new PhaistosSymbol(23), new PhaistosSymbol(37), new PhaistosSymbol(2), '|', new PhaistosSymbol(35), new PhaistosSymbol(7), new PhaistosSymbol(45), new PhaistosSymbol(27), '|', new PhaistosSymbol(7), new PhaistosSymbol(40), new PhaistosSymbol(22), new PhaistosSymbol(12), new PhaistosSymbol(2)]];
            } else if(diskOption === "vegas"){
                diskSymbols = [[new PhaistosSymbol(38), new PhaistosSymbol(3), new PhaistosSymbol(10), '|', new PhaistosSymbol(1, false, true), new PhaistosSymbol(13), '|', new PhaistosSymbol(21), new PhaistosSymbol(37), new PhaistosSymbol(35, false, true), new PhaistosSymbol(27, true), new PhaistosSymbol(27, true), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(38), new PhaistosSymbol(3), new PhaistosSymbol(10), '|', new PhaistosSymbol(35, false, true, true), new PhaistosSymbol(19), new PhaistosSymbol(23, false, true), '|', new PhaistosSymbol(1, false, true), new PhaistosSymbol(13), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(12), new PhaistosSymbol(26, false, true), new PhaistosSymbol(31, true)],
                    [new PhaistosSymbol(19), new PhaistosSymbol(17), new PhaistosSymbol(18), new PhaistosSymbol(6), '|', new PhaistosSymbol(27, true), new PhaistosSymbol(18), new PhaistosSymbol(32), new PhaistosSymbol(14), new PhaistosSymbol(27, true), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(26, false, true, true), new PhaistosSymbol(31, true), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(1, false, true, true), new PhaistosSymbol(28, false, true), '|', new PhaistosSymbol(18), new PhaistosSymbol(22), new PhaistosSymbol(10), new PhaistosSymbol(25), new PhaistosSymbol(27, true), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(26, false, true, subscript=true), new PhaistosSymbol(31, true), new PhaistosSymbol(12), new PhaistosSymbol(2, true)],
                    [new PhaistosSymbol(23, false, true), new PhaistosSymbol(33, false, true), '|', new PhaistosSymbol(21), new PhaistosSymbol(37), new PhaistosSymbol(35, false, true), new PhaistosSymbol(27, true), new PhaistosSymbol(27, true), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(26, false, true, true), new PhaistosSymbol(31, true), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(1, false, true), new PhaistosSymbol(28, false, true), '|', new PhaistosSymbol(18), new PhaistosSymbol(23, false, true), new PhaistosSymbol(10), new PhaistosSymbol(25), new PhaistosSymbol(27, true), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(11, false, true), new PhaistosSymbol(39, false, true)],
                    [new PhaistosSymbol(38), new PhaistosSymbol(23, false, true), new PhaistosSymbol(32), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(7, false, true), new PhaistosSymbol(40), new PhaistosSymbol(41), new PhaistosSymbol(1, false, true), '|', new PhaistosSymbol(35, false, true), new PhaistosSymbol(19), new PhaistosSymbol(41), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(35, false, true), new PhaistosSymbol(26, false, true), new PhaistosSymbol(31, true), '|', new PhaistosSymbol(46), new PhaistosSymbol(18), new PhaistosSymbol(6), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(2, true), new PhaistosSymbol(44), new PhaistosSymbol(27, true)],
                    [new PhaistosSymbol(12), new PhaistosSymbol(7, false, true), new PhaistosSymbol(45, false, true), new PhaistosSymbol(27, true), '|', new PhaistosSymbol(33, false, true), new PhaistosSymbol(40), new PhaistosSymbol(4), new PhaistosSymbol(12), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(34), new PhaistosSymbol(29, true), new PhaistosSymbol(29, true), '|', new PhaistosSymbol(7, false, true, true), new PhaistosSymbol(45, false, true), new PhaistosSymbol(29, true), '|', new PhaistosSymbol(12), new PhaistosSymbol(40), new PhaistosSymbol(24), '|', new PhaistosSymbol(18, false, false, true), new PhaistosSymbol(1, false, true), new PhaistosSymbol(13), new PhaistosSymbol(12), new PhaistosSymbol(2, true)],
                    [new PhaistosSymbol(7, false, true, true), new PhaistosSymbol(45, false, true), '|', new PhaistosSymbol(25), new PhaistosSymbol(23, false, true), new PhaistosSymbol(34), new PhaistosSymbol(29, true), '|', new PhaistosSymbol(7, false, true), new PhaistosSymbol(23, false, true), new PhaistosSymbol(35, false, true), new PhaistosSymbol(6), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(7, false, true), new PhaistosSymbol(18), new PhaistosSymbol(39, false, true), new PhaistosSymbol(30), new PhaistosSymbol(9), '|', new PhaistosSymbol(8, false, true, true), new PhaistosSymbol(7, false, true), new PhaistosSymbol(36), new PhaistosSymbol(29, true), new PhaistosSymbol(22), '|', new PhaistosSymbol(24), new PhaistosSymbol(18), new PhaistosSymbol(23, false, true), new PhaistosSymbol(7, false, true)],
                    [new PhaistosSymbol(7, false, true, true), new PhaistosSymbol(45, false, true), new PhaistosSymbol(7, false, true), '|', new PhaistosSymbol(35, false, true), new PhaistosSymbol(18), new PhaistosSymbol(7, false, true), '|', new PhaistosSymbol(25), new PhaistosSymbol(23, false, true), new PhaistosSymbol(34), new PhaistosSymbol(27, true), '|', new PhaistosSymbol(8, false, true, true), new PhaistosSymbol(7, false, true), new PhaistosSymbol(36), new PhaistosSymbol(29, true), new PhaistosSymbol(22), '|', new PhaistosSymbol(7, false, true, true), new PhaistosSymbol(25), new PhaistosSymbol(29, true), '|', new PhaistosSymbol(13), new PhaistosSymbol(8, false, true), new PhaistosSymbol(29, true)],
                    [new PhaistosSymbol(8, false, true, true), new PhaistosSymbol(7, false, true), new PhaistosSymbol(36), new PhaistosSymbol(29, true), '|', new PhaistosSymbol(1, false, true), new PhaistosSymbol(27, true), new PhaistosSymbol(9), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(33, false, true), new PhaistosSymbol(39, false, true), new PhaistosSymbol(32), new PhaistosSymbol(35, false, true), new PhaistosSymbol(6), '|', new PhaistosSymbol(1, false, true), new PhaistosSymbol(33, false, true), new PhaistosSymbol(29, true), '|', new PhaistosSymbol(18), new PhaistosSymbol(14), new PhaistosSymbol(16), '|', new PhaistosSymbol(35, false, true), new PhaistosSymbol(20), new PhaistosSymbol(24), new PhaistosSymbol(24), new PhaistosSymbol(29, true)],
                    [new PhaistosSymbol(1, false, true), new PhaistosSymbol(38), new PhaistosSymbol(25), new PhaistosSymbol(27, true), '|', new PhaistosSymbol(40), new PhaistosSymbol(36), new PhaistosSymbol(26, false, true), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(35, false, true), new PhaistosSymbol(40), new PhaistosSymbol(24), new PhaistosSymbol(7, false, true), '|', new PhaistosSymbol(25), new PhaistosSymbol(42), new PhaistosSymbol(37), new PhaistosSymbol(22), '|', new PhaistosSymbol(18), new PhaistosSymbol(1, false, true), new PhaistosSymbol(13), new PhaistosSymbol(7, false, true), new PhaistosSymbol(15), '|', new PhaistosSymbol(33, false, true), new PhaistosSymbol(39, false, true), new PhaistosSymbol(1, false, true)],
                    [new PhaistosSymbol(43, false, true, true), new PhaistosSymbol(18), new PhaistosSymbol(23, false, true), new PhaistosSymbol(16), '|', new PhaistosSymbol(12), new PhaistosSymbol(20), new PhaistosSymbol(24), new PhaistosSymbol(33, false, true), '|', new PhaistosSymbol(27, true), new PhaistosSymbol(25), new PhaistosSymbol(22), '|', new PhaistosSymbol(5, false, false, true), new PhaistosSymbol(23, false, true), new PhaistosSymbol(37), new PhaistosSymbol(2, true), '|', new PhaistosSymbol(35, false, true), new PhaistosSymbol(7, false, true), new PhaistosSymbol(45, false, true), new PhaistosSymbol(27, true), '|', new PhaistosSymbol(7, false, true), new PhaistosSymbol(40), new PhaistosSymbol(22), new PhaistosSymbol(12), new PhaistosSymbol(2, true)]];
            }

            // Creating list of possible symbols for those without substitutions
            possibleSymbols = ['κ', 'χ', 'ι', 'γ', 'π', 'φ', 'β', 'υ', 'τ', 'θ', 'δ', '῾', 'λ', 'μ', 'ν', 'γ', 'ρ', 'ῤ', 'σ', 'ζ', 'ξ', 'ψ', 'ζ', 'ᾰ', 'ᾱ', 'η', 'ε', "ει", 'ῐ', 'ῑ', 'ω', 'ο', "ου", 'ῠ', 'ῡ', "αι", "αυ", "ει", "ευ", "οι", "υι", 'ᾳ', 'ῃ', 'ῳ'];
            possibleVegasSymbols = ['α', 'ε', 'η', 'ι', 'o', 'υ', 'ω', 'σ', 'ρ', 'ν'];
            possibleVowelSymbols = ['α', 'ε', 'η', 'ι', 'o', 'υ', 'ω'];
            hexSymbols = ["", "&#x101D0", "&#x101D1", "&#x101D2", "&#x101D3", "&#x101D4", "&#x101D5", "&#x101D6", "&#x101D7", "&#x101D8", "&#x101D9", "&#x101DA", "&#x101DB", "&#x101DC", "&#x101DD", "&#x101DE", "&#x101DF", "&#x101E0", "&#x101E1", "&#x101E2", "&#x101E3", "&#x101E4", "&#x101E5", "&#x101E6", "&#x101E7", "&#x101E8", "&#x101E9", "&#x101EA", "&#x101EB", "&#x101EC", "&#x101ED", "&#x101EE", "&#x101EF", "&#x101F0", "&#x101F1", "&#x101F2", "&#x101F3", "&#x101F4", "&#x101F5", "&#x101F6", "&#x101F7", "&#x101F8", "&#x101F9", "&#x101FA", "&#x101FB", "&#x101FC", "#"];
            singleSubs = Array.from({length: 47}, (_, i) => "Unsubstituted");
            subTracker = Array.from({length: 47}, (_, i) => "Unsubstituted");
            substitutions = substitutions.split(',');

            // Loop through substitions, replacing values in single subs with the values from the substitution
            for(let i = 0; i < substitutions.length; i++){
                try{
                    singleSubs[i+1] = substitutions[i];
                    subTracker[i+1] = "Subbed";
                } catch {
                    continue;
                }
            }
            
            for(let i = 0; i < singleSubs.length; i++){
                if(singleSubs[i] === "Unsubstituted"){
                    let tempSub = '';
                    try{
                        const exclusions = document.getElementById('exclusion' + i).value.split(',');
                        
                        if(exclusions.length < possibleSymbols.length){
                            while(tempSub === '' || exclusions.includes(tempSub)){
                                tempSub = possibleSymbols[Math.floor(Math.random() * possibleSymbols.length)]
                            }
                        } else {
                            console.log("Too many exclusions for index " + i);
                            tempSub = possibleSymbols[Math.floor(Math.random() * possibleSymbols.length)];
                        }

                    } catch {
                        tempSub = possibleSymbols[Math.floor(Math.random() * possibleSymbols.length)];
                    }

                    singleSubs[i] = tempSub;
                }
            }

            // Loop through disk symbols, replacing values with the substitutions
            for(i = 0; i < diskSymbols.length; i++){
                let tempSymbolString = "", tempSubString = "", tempIndexString = "";
                let columnCounter = 0;
                let tempElement, tempOverride;
                for(j = 0; j < diskSymbols[i].length; j++){
                    if(diskSymbols[i][j] === "|"){
                        tempElement = document.getElementById('table' + (i + 1));
                        tempElement.rows[0].cells[columnCounter].innerHTML = tempSymbolString;
                        tempElement.rows[1].cells[columnCounter].innerHTML = tempIndexString;
                        tempElement.rows[2].cells[columnCounter].innerHTML = tempSubString;
                        tempSymbolString = "";
                        tempSubString = "";
                        tempIndexString = "";
                        columnCounter++;

                        tempSymbolString += " | ";
                        tempSubString += " | ";
                        tempIndexString += " | ";
                    } else {
                        tempSymbolString += hexSymbols[diskSymbols[i][j].index] + " ";
                        tempIndexString += diskSymbols[i][j].index + " ";

                        try {
                            tempOverride = document.getElementById("substitution" + diskSymbols[i][j].index + "S").value;
                        } catch (error) {
                            tempOverride = "";
                        }

                        if((diskSymbols[i][j].subscript) && (tempOverride !== "")){
                            tempSubString += tempOverride + " ";
                        } else if(subTracker[diskSymbols[i][j].index] === "Subbed"){
                            tempSubString += singleSubs[diskSymbols[i][j].index] + " ";
                        } else {
                            if(diskSymbols[i][j].vowel){
                                tempSubString += possibleVowelSymbols[Math.floor(Math.random() * possibleVowelSymbols.length)] + " ";
                            } else if(diskSymbols[i][j].vegas){
                                tempSubString += possibleVegasSymbols[Math.floor(Math.random() * possibleVegasSymbols.length)] + " ";
                            } else {
                                tempSubString += possibleSymbols[Math.floor(Math.random() * possibleSymbols.length)] + " ";
                            }
                        }
                    }
                }
                
                tempElement = document.getElementById('table' + (i + 1));
                tempElement.rows[0].cells[columnCounter].innerHTML = tempSymbolString;
                tempElement.rows[1].cells[columnCounter].innerHTML = tempIndexString;
                tempElement.rows[2].cells[columnCounter].innerHTML = tempSubString;
                returnString += tempSymbolString + "\n" + tempIndexString + "\n" + tempSubString + "\n\n";
            }

            return "";
        }
    </script>
</body>
</html>
